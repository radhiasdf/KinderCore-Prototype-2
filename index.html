<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TMM97RHP9P"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-TMM97RHP9P');
    </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KinderCore</title>
  <link rel="icon" href="icons/favicon.png" type="image/png">

  <link rel="stylesheet" href="styles.css">

</head>
<body>
  <div class="setup-modal" id="setupModal">
    <h2>Welcome!</h2>
    <p>Select your child's learning age:</p>
    <div class="age-controls">
      <button class="btn" onclick="changeAge(-1)">‚óÄ</button>
      <div class="age-number" id="ageDisplay">4</div>
      <button class="btn" onclick="changeAge(1)">‚ñ∂</button>
    </div>

    <p>Set your PIN (letters or numbers):</p>
    <input type="text" id="pinInput" placeholder="Enter your PIN" />
    <button class="btn" onclick="finishSetup()">Start</button>
  </div>

  <header>Kindercore</header>

  <!-- ///////////////////////////////// SCREEN TIME //////////////////////////// -->

  <div class="container">
    <section>
      <div class="app-item">
        <h2>Screen Time Controls (On Progress)</h2>
        <button class="btn" onclick="openControls()">Manage Limits</button>
      </div>
      
      <div class="app-item">
        <div style="display: flex; align-items: center; gap: 10px;">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/YouTube_full-color_icon_%282017%29.svg/2560px-YouTube_full-color_icon_%282017%29.svg.png" alt="YouTube" style="width: 24px; height: 24px;">
            <span>YouTube</span>
        </div>
        <span>Limit: 30 min</span>
        </div>
      <div class="app-item">
        <div style="display: flex; align-items: center; gap: 10px;">
            <img src="https://static.vecteezy.com/system/resources/thumbnails/016/716/450/small/tiktok-icon-free-png.png" alt="Tiktok" style="width: 24px; height: 24px;">
            <span>TikTok</span>
        </div>
        <span>Limit: 30 min</span>
        </div>
    </section>

    <!-- //////////////////////////// GAMES ///////////////////////////////// -->

    <section>
      <div class="game-item">
        <h2>Learn</h2>
        <a href="leaderboard.html" class="btn-leaderboards">üèÜ View Leaderboards</a>
      </div>
      <div class="game-item">
        <div style="display: flex; align-items: center; gap: 12px;">
            <img src="icons/mathtowericon.png" alt="Arithmetic Tower" style="width: 2cm; height: 2cm; border-radius: 8px;">
            <div>
                <strong>Arithmetic Tower</strong>
                <div class="score" id="bestArithmetic">‚≠êBest Score: --</div>
            </div>
        </div>
        <div>
          <button class="btn" onclick="startArithmeticGame()">Play</button>
        </div>
      </div>

      <div class="game-item">
        <div style="display: flex; align-items: center; gap: 12px;">
            <img src="icons/spellingbeeicon.png" a
            
            
            
            
            lt="Spelling" style="width: 2cm; height: 2cm; border-radius: 8px;">
            <div>
            <strong>Spelling Bee</strong>
            <div class="score" id="bestSpelling">‚≠êBest Score: --</div>
            </div>
        </div>
        <div>
            <button class="btn" onclick="startSpellingGame()">Play</button>
        </div>
      </div>

      <div class="game-item">
        <div style="display: flex; align-items: center; gap: 12px;">
            <img src="icons/spellingbeearabicicon.png" alt="Spelling" style="width: 2cm; height: 2cm; border-radius: 8px;">
            <div>
            <strong>Arabic Spelling Bee</strong>
            <div class="score" id="bestSpellingArabic">‚≠êBest Score: --</div>
            </div>
        </div>
        <div>
            <button class="btn" onclick="startArabicSpellingGame()">Play</button>
        </div>
      </div>
      <p id="coming-soon">More Games Coming Soon</p>
    </section>

  </div>

  
  </div>

  <!--/////////////////////////////////// SURVEY SECTION /////////////////////////////////// -->
  
  <section class="survey-section" style="margin: 10px; padding: 20px; border: 1px solid #ccc; border-radius: 8px;">

    <div class="notranslate" translate="no">
      <select id="languageSelect" style="padding: 5px; font-size: 14px; min-width: 220px;">
        <option value="">-- Choose language üåêüí¨--</option>
        <option value="en">English</option>
        <option value="id">Bahasa Indonesia</option>
        <option value="es">Espa√±ol</option>
        <option value="fr">Fran√ßais</option>
        <option value="de">Deutsch</option>
        <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
        <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
        <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        <option value="ja">Êó•Êú¨Ë™û</option>
        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
        <!-- add more options as needed -->
      </select>
      </div>
      
    <div
      style="display: flex; flex-direction: column; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
      <h2 style="margin: 0;">Survei Evaluasi (26 Pertanyaan)</h2>
      
    <form id="evaluationForm">
      <p>Silakan evaluasi produk dengan memilih satu lingkaran per baris:</p>

      <div class="table-wrapper">
        <table class="survey-table">
          <thead>
            <tr>
              <th></th>
              <th style="text-align: center;">1</th>
              <th style="text-align: center;">2</th>
              <th style="text-align: center;">3</th>
              <th style="text-align: center;">4</th>
              <th style="text-align: center;">5</th>
              <th style="text-align: center;">6</th>
              <th style="text-align: center;">7</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Rows inserted by JS -->
          </tbody>
        </table>
      </div>
      
      <!-- Mobile cards -->
      <div class="cards-wrapper" id="cardsWrapper">
        <!-- Cards inserted by JS -->
        </div>
      
      <button class="btn" type="submit" style="margin-top: 20px;">Submit Survey</button>
    </form>
  </section>

  <script type="module">
    import { items, createTableRows, createCards } from './survey.js';

    document.addEventListener("DOMContentLoaded", () => {
      createTableRows(items);
      createCards(items);
    });
  </script>

  <!-- //////////////////////////////// GOOGLE TRANSLATE ////////////////////////////-->

  <script type="module">
    import { initLanguageSelector } from './utils/languageSelector.js';
    initLanguageSelector("languageSelect");
  </script>

  <div id="google_translate_element" style="display: none;"></div>
  
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'id',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
        autoDisplay: false
      }, 'google_translate_element');
    }
  </script>
  
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <!-- /////////////////////////// FIREBASE SETUP ////////////////////////////////////// -->


    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  
  <script>

    const firebaseConfig = {
        apiKey: "AIzaSyBpuR6e7DNDxCkdhbG9g5y4jshDvc-XaEM",
        authDomain: "kindercore-leaderboard.firebaseapp.com",
        projectId: "kindercore-leaderboard",
        storageBucket: "kindercore-leaderboard.firebasestorage.app",
        messagingSenderId: "800292504950",
        appId: "1:800292504950:web:093383fed69be3542b6657",
        measurementId: "G-F916CR9FTE"
      };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    //////////////////////////// SUBMITTING SURVEY FORM DATA TO FIREBASE //////////////////////

    document.getElementById("evaluationForm").addEventListener("submit", function (event) {
        event.preventDefault();

        // Generate or retrieve a device-specific ID
        let deviceId = localStorage.getItem("deviceId");
        if (!deviceId) {
          deviceId = crypto.randomUUID();
          localStorage.setItem("deviceId", deviceId);
        }

        // (Optional) Versioning
        const currentVersion = "1.0";  // Change this when your website updates
        localStorage.setItem("lastSurveyVersion", currentVersion);

        // Collect the form data
        const formData = new FormData(event.target);
        const result = {};
        for (let [key, value] of formData.entries()) {
          result[key] = parseInt(value);
        }

        // Add extra metadata
        result.timestamp = firebase.firestore.FieldValue.serverTimestamp();
        result.version = currentVersion;

        // Write or update the survey response using the deviceId
        db.collection("survey_responses").doc(deviceId).set(result)
          .then(() => {
            alert("Submitted! You can fill this form again to edit your responses.");
            document.getElementById("evaluationForm").reset();
          })
          .catch((error) => {
            alert("Failed to submit survey: " + error);
          });

          const formDataObj = {
        deviceId: deviceId,
        version: currentVersion,
        answers: result
      };

      fetch("https://script.google.com/macros/s/AKfycbypilcIOytz1voafGXIQJfgRM20I5wgN5uDkerxw5IGO4OWD2lpMLiA01-fICldxxk/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(formDataObj)
      })
        .then(response => response.json())
        .then(data => {
          console.log("Google Sheets update success:", data);
        })
        .catch(error => {
          console.error("Error updating Google Sheets:", error);
        });
      });


  </script>


  <script>
    //////////////////////////////// NEW USER SETUP ///////////////////////////////////////////

    let age = 4;

    function changeAge(delta) {
      age = Math.max(0, Math.min(150, age + delta));
      document.getElementById("ageDisplay").innerText = age;
    }

    function finishSetup() {
      const pin = document.getElementById("pinInput").value.trim();
      if (pin === "") {
        alert("Please enter a PIN.");
        return;
      }
      localStorage.setItem("childAge", age);
      localStorage.setItem("parentPIN", pin);
      document.getElementById("setupModal").classList.add("hidden");
    }

    function openControls() {
      const entered = prompt("Enter your PIN to access controls:");
      const saved = localStorage.getItem("parentPIN");
      if (entered === saved) {
        window.location.href = "Manage Screen Time/full.html";
      } else {
        alert("Incorrect PIN.");
      }
    }

    function startArithmeticGame() {
      window.location.href = "Math Game GPT/math-game.html";
    }

    function startSpellingGame() {
      window.location.href = "Spelling Bee/spelling-bee-game.html";
    }

    function startArabicSpellingGame(){
      window.location.href = "Spelling Bee/spelling-bee-arabic.html";
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Only show setup on first visit
      const pinSet = localStorage.getItem("parentPIN");
      if (pinSet) {
        document.getElementById("setupModal").classList.add("hidden");
      }

      const bestMath = JSON.parse(localStorage.getItem("mathTowerScores") || '{}');
      
      if (bestMath) {
        const entries = Object.entries(bestMath);
        const parts = entries.map(([difficulty, data]) =>
          `${difficulty[0].toUpperCase() + difficulty.slice(1)}: ${data.blocks}`
        );
        document.getElementById("bestArithmetic").innerHTML = `‚≠êBest Scores:<br> ${parts.join('<br>')}`;
      }

      const bestSpelling = localStorage.getItem("bestSpelling");
      if (bestSpelling) {
        document.getElementById("bestSpelling").innerText = `‚≠êBest Score: ${bestSpelling}`;
      }

      const bestSpellingArabic = localStorage.getItem("bestSpellingArabic");
      if (bestSpellingArabic) {
        document.getElementById("bestSpellingArabic").innerText = `‚≠êBest Score: ${bestSpellingArabic}`;
      }
    });
  </script>
</body>
</html>
